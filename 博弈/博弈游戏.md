博弈游戏
--------

### 博弈问题综述

所讨论的博弈问题满足以下条件：

1.  玩家只有两个人，轮流做出决策，且操作公平。

2.  游戏的状态集有限，保证游戏在有限步后结束.

3.  博弈双方都使用最优决策。

一个游戏有两个状态，我们称为必胜态和必败态，他们的关系：

-   必胜态表示，从当前状态可以转移到一个必败态。

-   必败态表示，从当前状态无法转移到一个必败态。

也就是说，一个状态不是必胜态，就是必败态。

### Bash博弈（同余理论）

**问题：**一堆$n$个物品，两个人从轮流中取出$1$到$m$个，无法取者失败。

**解法：**当$(m+1)|n$时，先手必败，其余情况，先手必胜。
当剩余的物品数量为$(m+1)$的整数倍时，为必败态，此时无论先手取多少个，后手只需要使两次取的物品数的总和是$(m+1)$，下一个状态依然处于必败态。

### Nim博弈（异或理论）

**问题：**$n$堆物品，每堆有$a_i$个，每次在某一堆中操作，取出至少1个物品，无法操作者失败。

**解法：**定义$S=\oplus_{i=0}^na_i$为$n$堆石子的异或和，则当$S=0$时，先手必败，其余情况先手必胜。
原理为对于一个异或和为$0$的状态，只要对其中一个数的任意一个二进制位进行改动，其异或和一定会发生变化，变为非$0$值。
此时对于异或和非$0$的局面，后手一定可以找到现在异或和中非$0$的最高位，既然次位的异或和为$1$，那么在所有的堆中,至少有一堆该位二进制值为$1$。
我们选定此数进行减值，将该位改为$0$（这时，后面的位无论是什么，都一定比原来小），低于该位的位数按照异或和进行构造，使新的异或和为$0$，此时的下一个状态依然是必败态。

### Wythoff博弈

**问题：**有两堆石子，个数为$x,y$（不妨设$x\le y$），每次每个人可以从任意一堆石子中取任意多的石子或者从两堆石子中取同样多的石子，不能取得人输。

**解法：**当$\lfloor\frac{(y-x)(\sqrt5+1)}{2}\rfloor=x$时先手必败，否则先手必胜。
该题可以转化为：在一个仅有第一象限的棋盘上的$(x,y)$处有一个棋子，该棋子只能向两个坐标减小的方向移动。具体地，该棋子可以向平行于$x,y$轴的方向走任意多步，也可以向平行于$y=x$的直线方向走任意多步，不能移动棋子的一方失败。
通过在棋盘划出必胜位置线，剩余的位置即为必败位置。

### Fibonacci博弈

**问题：**一堆石子有$n$个，两人轮流取，先取者第1次可以取任意多个，但不能全部取完，以后每次取的石子数不能超过上次取子数的2倍，不能取者输。

**解法：**当$n$是斐波那契数的时候，先手必败，否则先手必胜。

### SG函数（异或理论扩展）

$$SG[x]=\text{mex}\{SG[y]\}$$
其中$y$是$x$所有的后继状态（通过操作改变当前状态为后继态），$\text{mex}$是最小的没有出现的连续自然数。

#### 游戏的和

游戏$x_1,x_2,...,x_n$的和为$x$，且$x=\{x_1,x_2,...,x_n\}$。
理解为$x$是由$x_1,x_2,...,x_n$构成的新游戏。

#### SG定理

如果一个游戏的所有子游戏相互独立（即一个子游戏的操作不会影响其他的子游戏），那么$$SG[x]=SG[x_1]\text{ xor }SG[x_2]\text{ xor }...\text{ xor }SG[x_n]$$
文字表述为，一些游戏的和的$SG$函数等于各个游戏$SG$函数的异或和。

#### 原理

**SG函数本质上是把博弈问题转化为Nim博弈进行求解**，一个子游戏相当于一堆石子，SG函数的值即为该堆石子的个数，整个游戏的SG值为所有子游戏的异或和，即Nim博弈中，将每堆石子个数异或起来。
若当前局面为必败态（SG值为0），改变整个游戏中任意一个子游戏到其后继状态时，所有子游戏SG函数值的异或和必然发生变化，取次值二进制的最高位，所有子游戏中的SG函数值二进制中，至少有一个数的二进制该位为1，找到次数所表示的子游戏。
该子游戏的SG值，是对该子游戏所有后继状态的SG值取mex，这就意味着，我们可以通过执行当前子游戏的某个后继状态，把当前子游戏的SG值变为小于该值的任意一个自然数。这相当于Nim博弈中取走一些石子做减法。
通过这样的变化，后手可以把当前游戏的SG函数值再次变为0，此时下一个状态依旧必败。
