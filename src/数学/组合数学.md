组合数学相关
------------

### 相关定理

#### 定理1

$\{1, 2, … n\}$的r组合$a_1, a_2,...,a_r$出现在所有r组合中的字典序位置编号：
$$index = C(n, r) - C(n - a_1, r) - C(n - a_2, r - 1) - … - C(n - a_r, 1)$$

#### 定理2

$$k * C(n, k) = n * C(n - 1, k - 1)$$
$$C(n, 0) + C(n, 2) + … = C(n, 1) + C(n, 3) + …$$
$$1 * C(n, 1) + 2 * C(n, 2) + … + n * C(n, n) = n * 2^{n - 1}$$

### 错位排列

$$D_n=n!\sum_{k=0}^{n}\frac{(-1)^k}{k!}$$

### Catalan数

凸多边形三角划分,n个节点组成二叉搜索树，n对括号正确匹配数目，1-n的出栈序列
$$C_n = \frac{C(2 * n, n)}{n + 1}$$
$$C_n = \frac{(4 * n - 2)}{n + 1} * C_n - 1$$ $$C_1 = 1$$

### Stirling数

#### 第一类Stirling数

s(p, k)将 p 个不同元素构成 k 个圆排列的数目。
$$s(p, k) = (p - 1) * s(p - 1, k) + s(p - 1, k - 1)$$

#### 第二类Stirling数

n个元素拆分k个集合的方案数记为S(n, k)。
$$S(p, k) = k * S(p - 1, k) + S(p - 1, k - 1)$$
$$S(p, 0) = 0, (p >= 1)$$ $$S(p, p) = 1, (p >= 0)$$
$$S(p, 1) = 1, (p >= 1)$$ $$S(p, 2) = 2^{p - 1} - 1, (p >= 2)$$
$$S(p, p - 1) = C(p, 2)$$

### Bell数

元素个数为n的集合的划分数目。 $$B_p = \sum_{i=0}^{p}S(p, i)$$
其中$S(p,i)$表示第二类Stirling数。
$$B_p = C(p - 1, 0) * B_0 + C(p - 1, 1) * B_1 + … + C(p - 1, p - 1) * B_{p - 1}$$

### 卢卡斯定理

若$p$是质数： $$C(n,m)\%p=C(n/p,m/p)*C(n\%p,m\%p)\%p$$
若$p$不是质数，令$p=p_1*p_2*...*p_n$，这里$p_i$是质数 $$\left\{
\begin{aligned}
C_n^m \equiv & a_1 \pmod {p_1} \\
C_n^m \equiv & a_2 \pmod {p_2} \\
\vdots \\
C_n^m \equiv & a_n \pmod {p_n}
\end{aligned}
\right.$$ 则分别求出$a_1,a_2,...,a_n$用中国剩余定理合并即可。


#### 3.1. 盒子放小球问题
$n$个小球，$m$个盒子。
##### 3.1.1 n个小球有区别，m个盒子有区别
(1)允许空盒：每个球放到任意盒子里，总方案数$m^n$。
(2)不允许空盒：需满足$n \geq m\geq 1$ ，$m>n$时无解。其方案数及时看成m个盒子相同时的方案数，再乘以$m!$。答案即是$S(n,m)*m!$。S代表第二类斯特林数。
##### 3.1.2 n个小球有区别，m个盒子无区别
(1)允许空盒：假设放了k个盒，$m\geq k\geq 1$。那么答案就是$\sum_{k=1}^{m}S(n,k)$。
(2)不允许有空盒：$S(n,m)$。
##### 3.1.3 n个小球无区别，m个盒子有区别
(1)允许空盒：$n\geq m\geq 1$。“隔板法”。假设不允许有空盒，每一个盒里都先放一个小球，这样小球共有$n+m$个，然后插板，插板的方案数为$C^{n-1}_{n+m-1}$。
(2)不允许空盒：$n\geq m\geq 1$。“隔板法”。方案数$C^{m-1}_{n-1}$。
##### 3.1.4 n个小球无区别，m个盒子无区别
(1)允许空盒：划分数问题。$dp[i][j]$表示i个球，j个盒子的方案数。转移方程为
$$dp[i][j]=dp[i-j][j]+dp[i][j-1] (i\geq j)$$
$$dp[i][j]=dp[i][j-1] (i< j)$$
如果$n<m$，答案为$dp[n][n]$，否则为$dp[n][m]$。
(2)不允许空盒：$n\geq m\geq 1$。转成上情况的$n-m$个小球，$m$个盒子。

#### 3.2. 计数原理与计数公式
##### 3.2.1 可重复的排列与组合
###### 3.2.1.1 可重复的排列
从n个不同元素中取m个元素（同一元素可以重复取出），按照一定的顺序排成一列。排列的个数为$n^m$。
###### 3.2.1.2 可重复的组合
从n个不同元素中取m个元素（同一元素可以重复取出），并成一组。组合的个数为$C^{m}_{n+m-1}$。
【证明】
$1,2,...,n$表示n个不同元素。从中取m个可以表示成：
$$\{i_1,i_2,...,i_m\} (1\leq i_1\leq i_2 \leq ... \leq i_m \leq n)$$
令$j_k = i_k + (k-1)$，即：
$$\begin{aligned}j_1 &= i_1\\
j_2 &= i_2+ 1\\
j_3 &= i_3 + 2\\
...\\
j_m &=i_m+(m-1)
\end{aligned}$$
可以得到组合
$$\{j_1,j_2,...,j_m\} (1\leq j_1< j_2 < ... <j_m \leq n-m+1)$$
这样就相当于在$n+m-1$个元素中取$m$个不相同的元素，作为一组。
因此即是$C_{n+m-1}^{m}$。

###### 3.2.1.3 不全相异元素的全排列
n个元素中，分别有$n_1,n_2,...,n_k$个元素相同，且$n_1+n_2+...+n_k=n$，则称这n个元素的全排列为不全相异元素的全排列，个数为
$$\frac{n!}{n_1!n_2!...n_k!}$$

###### 3.2.1.4 多组组合
n个相异的元素分为$k(k\leq n)$个按照**一定顺序**排列的组，其中第$i$组有$n_i$个元素$(i=1,2,...,k)(n_1+n_2+...+n_k=n)$。不同的分组方法为
$$\frac{n!}{n_1!n_2!...n_k!}$$
【例】
从$n(n\geq 6)$个选手中选3对选手参加双打，问共有多少种选法。
答案为（注意不考虑**组的顺序**）
$$\frac{C_{n}^{6}*\frac{6!}{2!*2!*2!}}{3!}$$

##### 3.2.2  相异元素的圆排列和项链数
###### 3.2.2.1 圆排列
n个元素不分首尾排成一圈，成为n个相异元素的圆排列。排列的种数为$(n-1)!$。
###### 3.2.2.2 项链数
将n粒不相同的珠子，穿成一副项链，得到的不同的项链数。
由于项链顺时针和逆时针都是相同的，所以个数即是圆排列的一半。
$$\left\{
\begin{aligned}
&1,n = 1或n=2\\
&\frac{1}{2}*(n-1)!,n\geq3
\end{aligned}
\right.$$
##### 3.2.3 错排问题
错排递推式。
$D(n)$代表$n$个数的错排公式，则
$$D(n) = (n-1)*[D(n-1)+D(n-2)]$$
错排公式
$$D(n) = n!(1-\frac{1}{1!}+\frac{1}{2!}-\frac{1}{3!}+...+\frac{(-1)^n}{n!})$$


##### 3.2.4 组合数常用公式
$$\begin{aligned}
&C_{n}^{2} = \frac{n*(n-1)}{2}\\
&\\
&C_{n}^{3}=\frac{n*(n-1)(n-2)}{6}\\
&\\
&C_{n}^{m}=C_{n-1}^{m-1}+C_{n-1}^{m}\\
&\\
&m*C_{n}^{m} = n*C_{n-1}^{m-1}\\
&\\
&C_n^0+C_n^1+...+C_n^n =2^n\\
&\\
&1C_n^1+2C_n^2+...+nC_n^n=n2^{n-1}\\
&\\
&1^2C_n^1+2^2C_n^2+...+n^2C_n^n=n(n+1)2^{n-2}\\
&\\
&\frac{C_n^1}{1}-\frac{C_n^2}{2}+\frac{C_n^3}{3}+...+(-1)^{n-1}\frac{C_n^n}{n}=1+\frac{1}{2}+\frac{1}{3}+...+\frac{1}{n}\\
&\\
&(C_n^0)^2+(C_n^1)^2+(C_n^2)^2+...+(C_n^n)^2=C_{2n}^n\\
\end{aligned}$$
范德蒙恒等式:
$$\sum_{i=0}^{k}C_n^iC_m^{k-i}=C_{n+m}^k$$

经验式(link [https://www.cnblogs.com/qrsikno/p/10170523.html](https://www.cnblogs.com/qrsikno/p/10170523.html)):
$$\begin{aligned}
&\sum_{i=0}^{n}C_n^i*r^i=(r+1)^n（广义二项式定理）\\
&\\
&\sum_{i=0}^{n}i*C_n^i=n*2^{n-1}\\&\\
&\sum_{i=0}^{n}C_i^k=C_{n+1}^{k+1}\\&\\
&\sum_{i=0}^{k}C_{n+i}^i=C_{n+k+1}^{k}\\
\end{aligned}$$


#### 3.3. 抽屉原理与平均值原理
##### 3.3.1 抽屉原理
###### 3.3.1.1 第一抽屉原理
如果将m个物件放入n个抽屉内，那么必有一个抽屉内至少有$[\frac{m-1}{n}]+1$个物件。
【推广】
如果将$m_1+m_2+...+m_n+1$个物件放入n个抽屉内，那么或者第一个抽屉内至少有$m_1+1$个物件，或者第二个抽屉内至少有$m_2+1$个物件……或者第n个抽屉内至少有$m_n+1$个物件。
###### 3.3.1.2 第二抽屉原理
如果将m个物件放入n个抽屉内，那么必有一个抽屉内至多有$[\frac{m}{n}]$个物件。
【推广】
如果将$m_1+m_2+...+m_n-1$个物件放入n个抽屉内，那么或者第一个抽屉内至多有$m_1-1$个物件，或者第二个抽屉内至多有$m_2-1$个物件……或者第n个抽屉内至多有$m_n-1$个物件。
##### 3.3.2 平均值原理
（1）设$a_1,a_2,...,a_n$是实数，$A =\frac{1}{n}(a_1+a_2+...+a_n)$，则$a_1,a_2,...,a_n$中必有一个数不小于A，也有一个数不大于A。
（2）设$a_1,a_2,...,a_n$是实数，$G =\frac{1}{n}\sqrt[n]{a_1a_2...a_n}$，则$a_1,a_2,...,a_n$中必有一个数不小于G，也有一个数不大于G。
#### 3.4. 生成函数
生成函数的定义：
实数序列 $a_0,a_1,...,a_k,...$的生成函数是无穷级数
$$G(x)=a_0+a_2x+...+a_kx^k+...=\sum_{k=0}^{\infty}a_kx^k$$
${a_k}$的普通生成函数。
广义二项式系数：
$$\dbinom{u}{k}=\left \{ \begin{aligned}&u(u-1)(u-2)...(u-k+1)/k!,&k>0\\
&1,&k=0
\end{aligned}\right.$$
 【例】
 $$\begin{aligned}\dbinom{1/2}{3}&=\frac{(1/2)(1/2-1)(1/2-2)}{3!}\\
 &=\frac{(1/2)(-1/2)(-3/2)}{6}\\
 &=1/16 
 \end{aligned}$$
设$x$是实数，$|x|<1$，$u$是实数，那么
$$(1+x)^u=\sum_{k=0}^{\infty}\dbinom{u}{k}x^k$$

##### 3.4.1 常用生成函数
$$\begin{aligned}
&\frac{1-x^{n+1}}{1-x}=\sum_{k=0}^{n}x^k\\
&\\
&\frac{1}{1-ax}=\sum_{k=0}^{\infty}a^kx^k\\
&\\
&\frac{1}{(1-x)^2}=\sum_{k=0}^{\infty}(k+1)x^k\\
&\\
&\frac{1}{(1-x)^n}=\sum_{k=0}^{\infty}C_{n+k-1}^{k}x^k\\
&\\
&\frac{1}{(1+x)^n}=\sum_{k=0}^{\infty}C_{n+k-1}^{k}(-1)^kx^k\\
\end{aligned}$$
##### 3.4.2 计数问题

#### 3.5. 特殊计数序列
##### 3.5.1 Catalan数列
前几项：$1, 1, 2, 5, 14, 42, 132, 429, 1430, 4862, 16796, 58786, 208012, ......$即$c[0]=1,c[1]=1,c[2]=2...$

$$\begin{aligned}
&递推式1：f[n]=\sum_{i=0}^{n-1}f[i]*f[n-i-1]\\
&\\
&递推式2：f[n]=\frac{4n-2}{n+1}f[n-1]\\
&\\
&组合式1：f[n]=\frac{C_{2n}^{n}}{n+1}\\
&\\
&组合式2：f[n] = C_{2n}^{n}-C_{2n}^{n-1}
\end{aligned}$$

应用：
1. 二叉树计数1：已知二叉树有$n$个节点，能够构成$C_{n}$种不同的二叉树。（二叉搜索树）
2. 二叉树计数2：已知二叉树的叶子$n$个，能够构成$C_{n-1}$种不同的二叉树。（二叉搜索树）
3. 括号匹配数：一个合法的表达式由()包围，()可以嵌套和连接，给出$n$对括号，可以组成的合法表达式的个数为$C_{n}$。
4. 划分问题：将一个凸$n+2$多边形区域分成三角形区域的方法数为$C_{n}$。
5. 出栈问题1：一个栈的进栈序列为$1,2,3,..n$，不同的出栈序列有$C_{n}$种。
6. 出栈问题2：有2n个人排成一行进入剧场。入场费5元。其中只有n个人有一张5元钞票，另外n人只有10元钞票，剧院无其它钞票，问有多少种方法使得只要有10元的人买票，售票处就有5元的钞票找零。5元的相当于入栈，10元的相当于出栈，转化成上问题。
7. 路径问题：在$n*n$的方格地图中，从一个角到另外一个角，不跨越对角线的路径数有$C_{n}$种。
8. 握手问题：$2n$个人均匀坐在一个圆桌边上，某个时刻所有人同时与另一个人握手，要求手之间不能交叉，共有$C_{n}$种握手方法。
##### 3.5.2 Fibonacci数列
通项公式：$$F_n=\frac{1}{\sqrt{5}}[(\frac{1+\sqrt{5}}{2})^n-(\frac{1-\sqrt{5}}{2})^n]$$
递推式：
$$F_n=F_{n-1}+F_{n-2}$$
性质：
$$\begin{aligned}&F_1+F_1+F_2+F_3+...+F_n=F_{n+2}-1\\
&\\
&F_1+2F_2+3F_3+...+nF_n=nF_{n+2}-F_{n+3}+2\\
&\\
&F_1+F_3+F_5+...+F_{2n-1}=F_{2n}\\
&\\
&F_2+F_4+F_6+...+F_{2n}=F_{2n+1}-1\\
&\\
&F_1^2+F_2^2+F_3^2+...+F_n^2=F_nF_{n+1}\\
&\\
&F_{n-1}F_{n+1}-F_n^2=(-1)^n
\end{aligned}$$

定理：
$$\begin{aligned}
&F_nF_m+F_{m-1}F_{n-1}=F_{m+n-1}\\
&\\
&F_mF_{n+1}+F_{m-1}F_n=F_{m+n}\\
&\\
&m=n时，\\
&F_{2n-1}=F_n^2+F_{n-1}^2\\
&\\
&F_{2n}=(F_{n-1}+F_{n+1})F_n=(2F_{n-1}+F_n)F_n\\
&\\
&F_n整除F_m当且仅当n整除m，其中n\geq3\\
&\\
&任意连续三个Fibonacci数两两互素。
\end{aligned}$$

##### 3.5.3 Lucas数列
定义：
$$L_n=
\left\{\begin{aligned}&2,&n=1\\
&1,&n=2\\
&L_{n-1}+L_{n-2},&n\geq3
\end{aligned}
\right.$$
通项公式：
$$L_n=(\frac{1+\sqrt{5}}{2})^n+(\frac{1-\sqrt{5}}{2})^n$$
与Fibonacci数的关系：
$$\begin{aligned}
&F_{2n}=L_nF_n\\
&\\
&L_n=F_{n-1}+F_{n+1}\\
&\\
&F_n=\frac{L_{n-1}+L_{n+1}}{5}\\
&\\
&L_n^2=5F_n^2+4(-1)^n
\end{aligned}$$
##### 3.5.4 Stirling数
###### 3.5.4.1 第一类Stirling数

$S1(n,m)$表示的是将$n$个不同元素构成$m$个圆排列的数目。
递推式：
$$S1(n,m)=(n-1)*S1(n-1,m)+S1(n-1,m-1)(n>1,m>1)$$

边界条件：
$$\begin{aligned}
&S1(0,0)=1,S1(n,0) = 0\\
&S1(n,n) = 1
\end{aligned}$$
性质：
$$\sum_{k=0}^{n}S1(n,k)=n!$$
【例】$n$个仓库， $2n$把钥匙，$n$ 位官员。如果把$n$位官员分成$m$个不同的部，部中的官员数量与管理的仓库数量一致。有多少种方案使得所有同部的官员可以打开所有本部管理的仓库，而无法打开其他管理的仓库。（$n$把钥匙放到仓库，$n$把钥匙分给官员）
方案数即为$S1(n,m)n!$。
前面的是放到仓库里的方案数，后面说官员的分配方案。

###### 3.5.4.2 第二类Stirling数
$S2(n,m)$表示的是把$n$个不同元素划分到$m$个集合的方案数。
递推式：
$$S2(n,m)=m*S2(n-1,m)+S2(n-1,m-1)(1\leq m\leq n-1)$$
边界条件：
$$\begin{aligned}
&S2(n,0)=0,S2(n,1)=1\\
&S2(n,n)=1
\end{aligned}$$